<html>
<head>
  <meta charset="utf-8">
  <title>文件上传</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/antd/4.16.13/antd.min.css">
</head>
<body>
  <div id="root"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/antd/4.16.13/antd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.4/axios.min.js"></script>
  <script>
    const { useState } = React;
    const { Upload, Button, message, Input, Form } = antd;
    const { UploadOutlined } = antd.icons;

    function App() {
      const [file, setFile] = useState(null);
      const [token, setToken] = useState("");
      const [key, setKey] = useState("");

      const handleChange = (info) => {
        if (info.file.status === "done") {
          setFile(info.file.originFileObj);
        }
      };

      const handleSubmit = async () => {
        if (!file || !token || !key) {
          message.error("请填写完整的信息");
          return;
        }
        const formData = new FormData();
        formData.append("file", file);
        try {
          const res = await axios.post(`https://v.zzsp.eu.org/api/file?token=${token}`, formData, {
            headers: {
              "Content-Type": "multipart/form-data",
              "Authorization": key
            }
          });
          message.success("上传成功");
          console.log(res.data);
        } catch (err) {
          message.error("上传失败");
          console.error(err);
        }
      };

      return (
        <div style={{ width: "600px", margin: "0 auto", padding: "50px" }}>
          <h1 style={{ textAlign: "center" }}>文件上传</h1>
          <Form layout="vertical" onFinish={handleSubmit}>
            <Form.Item label="选择文件">
              <Upload name="file" onChange={handleChange} showUploadList={false}>
                <Button icon={<UploadOutlined />}>点击上传</Button>
              </Upload>
            </Form.Item>
            <Form.Item label="输入API">
              <Input value={token} onChange={(e) => setToken(e.target.value)} placeholder="请输入API" />
            </Form.Item>
            <Form.Item label="输入密钥">
              <Input value={key} onChange={(e) => setKey(e.target.value)} placeholder="请输入密钥" />
            </Form.Item>
            <Form.Item>
              <Button type="primary" htmlType="submit">提交</Button>
            </Form.Item>
          </Form>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById("root"));
  </script>
</html>
